{% include base_path %}

{% if post.id %}
  {% assign title = post.title | markdownify | remove: "<p>" | remove: "</p>" %}
{% else %}
  {% assign title = post.title %}
{% endif %}

{% comment %} Decode HTML entities for display (no backslash escapes to avoid GitHub Pages Liquid issues) {% endcomment %}
{% assign authors_display = post.authors_short | default: post.citation %}
{% comment %} Handle "..." before Pierrot's name: protect it, replace other "...", then restore {% endcomment %}
{% if authors_display contains "Pierrot Lamontagne" %}
  {% assign author_parts = authors_display | split: "Pierrot Lamontagne" %}
  {% if author_parts.size > 1 %}
    {% comment %} Check if there's ", ..." before Pierrot's name {% endcomment %}
    {% assign before_name = author_parts[0] %}
    {% assign after_name = author_parts[1] %}
    {% if before_name contains ", ..." %}
      {% assign before_name = before_name | replace: ", ...", ", __KEEP_DOTS__" %}
    {% endif %}
    {% assign before_name = before_name | replace: "...", "et al." | replace: "others", "et al." %}
    {% assign before_name = before_name | replace: "__KEEP_DOTS__", "..." %}
    {% assign after_name = after_name | replace: "...", "et al." | replace: "others", "et al." %}
    {% assign authors_display = before_name | append: "Pierrot Lamontagne" | append: after_name %}
  {% else %}
    {% assign authors_display = authors_display | replace: "...", "et al." | replace: "others", "et al." %}
  {% endif %}
{% else %}
  {% assign authors_display = authors_display | replace: "...", "et al." | replace: "others", "et al." %}
{% endif %}
{% assign authors_display = authors_display | replace: "&amp;", "&" | replace: '&quot;', '"' %}
{% assign authors_display = authors_display | replace: "{\&apos;e}", "é" | replace: "{\&apos;a}", "á" | replace: "{\&apos;i}", "í" | replace: "{\&apos;o}", "ó" | replace: "{\&apos;u}", "ú" %}
{% assign authors_display = authors_display | replace: "L{\&apos;e}na", "Léna" | replace: "Fran{\c{c}}ois", "François" | replace: "Ren{\&apos;e}", "René" %}
{% assign authors_display = authors_display | replace: "{\&apos;E}tienne", "Étienne" | replace: "Fr{\&apos;e}d{\&apos;e}rique", "Frédérique" %}
{% assign authors_display = authors_display | replace: "Jonay I. Gonz{\&apos;a}lez Hern{\&apos;a}ndez", "Jonay I. González Hernández" %}
{% assign authors_display = authors_display | replace: "Damien S{\&apos;e}gransan", "Damien Ségransan" | replace: "St{\&apos;e}phane", "Stéphane" | replace: "Jos{\&apos;e}", "José" %}
{% assign authors_display = authors_display | replace: "David Lafreni{\`e}re", "David Lafrenière" | replace: "N{\&apos;e}stor", "Néstor" | replace: "Andr{\&apos;e}", "André" %}
{% assign authors_display = authors_display | replace: "Lo{\&quot;i}c", "Loïc" %}
{% assign authors_display = authors_display | replace: "Su{\&apos;a}rez", "Suárez" %}
{% assign authors_display = authors_display | replace: "G{\&apos;e}rard", "Gérard" | replace: "C{\&apos;e}line", "Céline" %}
{% assign authors_display = authors_display | replace: "Philippe Vall{\&apos;e}e", "Philippe Vallée" | replace: "M{\&apos;a}rcio", "Márcio" %}
{% assign authors_display = authors_display | replace: "Bj{\&quot;o}rn", "Björn" | replace: "K{\&quot;a}ufl", "Käufl" %}
{% assign authors_display = authors_display | replace: "Jonathan Gagn{\&apos;e}", "Jonathan Gagné" %}
{% assign authors_display = authors_display | replace: "F{\&apos;e}lix", "Félix" | replace: "T{\&apos;e}mich", "Témich" %}
{% assign authors_display = authors_display | replace: "S{\&apos;e}bastien", "Sébastien" | replace: "Jean-S{\&apos;e}bastien", "Jean-Sébastien" %}
{% assign authors_display = authors_display | replace: "Pierrot Lamontagne", "__AUTHOR_NAME__" %}

<div class="{{ include.type | default: 'list' }}__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    <h2 class="archive__item-title" itemprop="headline">
      {% if post.paperurl %}
        <a href="{{ post.paperurl }}" target="_blank" rel="noopener">{{ title }}</a>
      {% elsif post.link %}
        <a href="{{ post.link }}" target="_blank" rel="noopener">{{ title }}</a>
      {% else %}
        <a href="{{ base_path }}{{ post.url }}" rel="permalink">{{ title }}</a>
      {% endif %}
    </h2>

    <p>
      {% assign author_parts = authors_display | split: "__AUTHOR_NAME__" %}
      {% if author_parts.size > 1 %}
        {{ author_parts[0] }}<strong>Pierrot Lamontagne</strong>{{ author_parts[1] }} &mdash; <i>{{ post.venue }}</i>, {{ post.date | default: "1900-01-01" | date: "%Y" }}
      {% else %}
        {{ authors_display }} &mdash; <i>{{ post.venue }}</i>, {{ post.date | default: "1900-01-01" | date: "%Y" }}
      {% endif %}
    </p>

    {% if post.biburl %}
    <p>
      <a href="{{ base_path }}{{ post.biburl }}" target="_blank" rel="noopener">BibTeX</a>
    </p>
    {% endif %}
  </article>
</div>
